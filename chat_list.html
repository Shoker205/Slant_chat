<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slant - Vector Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;900&display=swap');

        :root {
            --bg: #000000;
            --surface: #0e0e0e;
            --border: #1a1a1a;
            --text-main: #ffffff;
            --text-dim: #777777;
            --accent: #ffffff;
            --dock-bg: rgba(15, 15, 15, 1);
            --error: #ff3b30;
            --success: #34c759;
            --bezier: cubic-bezier(0.4, 0, 0.2, 1);
            --toast-bg: rgba(14, 14, 14, 0.95);
            --badge-bg: #ffffff;
            --badge-text: #000000;
        }

        .light-theme {
            --bg: #ffffff;
            --surface: #f5f5f5;
            --border: #eeeeee;
            --text-main: #000000;
            --text-dim: #888888;
            --accent: #000000;
            --dock-bg: rgba(240, 240, 240, 1);
            --toast-bg: rgba(250, 250, 250, 0.95);
            --badge-bg: #000000;
            --badge-text: #ffffff;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; transition: background 0.5s var(--bezier), color 0.5s var(--bezier), border-color 0.5s var(--bezier); }

        body {
            background: var(--bg);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            touch-action: pan-y;
        }

        .screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg);
            z-index: 50;
            transform: translateY(100%);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
        }
        .screen.active { transform: translateY(0); }

        header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }

        .user-trigger {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
            background: var(--surface);
            transition: transform 0.2s var(--bezier);
        }
        .user-trigger:active { transform: scale(0.9); }
        .user-trigger img { width: 100%; height: 100%; object-fit: cover; }

        .header-center { font-weight: 900; font-size: 16px; letter-spacing: 3px; text-transform: uppercase; }

        .drawer-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 100;
            opacity: 0; visibility: hidden; transition: 0.5s var(--bezier);
        }
        .drawer-overlay.active { opacity: 1; visibility: visible; }

        .drawer {
            position: fixed;
            top: 0; left: -310px; width: 310px; height: 100%;
            background: var(--bg);
            border-right: 1px solid var(--border);
            z-index: 101;
            transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
        }
        .drawer.active { transform: translateX(310px); }

        .drawer-header { padding: 40px 24px 20px; border-bottom: 1px solid var(--border); }
        .profile-pic-container { width: 64px; height: 64px; border-radius: 20px; background: var(--surface); margin-bottom: 15px; border: 1px solid var(--border); overflow: hidden; }
        .profile-pic-container img { width: 100%; height: 100%; object-fit: cover; }

        .drawer-content { flex: 1; overflow-y: auto; padding: 10px 0; }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 14px 24px;
            gap: 16px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .menu-item:active { background: var(--surface); }
        .menu-item svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        .divider { height: 1px; background: var(--border); margin: 8px 24px; }

        .main-content { height: 100%; overflow-y: auto; padding-bottom: 100px; scroll-behavior: smooth; }
        
        .chat-item-wrapper {
            position: relative;
            overflow: hidden;
            background: var(--badge-bg);
        }
        .chat-item { 
            display: flex; 
            padding: 14px 20px; 
            gap: 14px; 
            align-items: center; 
            cursor: pointer; 
            background: var(--bg);
            position: relative;
            z-index: 2;
            transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        .chat-item.swiped { transform: translateX(-80px); }
        .chat-read-action {
            position: absolute;
            right: 0; top: 0; bottom: 0;
            width: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--badge-text);
            font-size: 10px;
            font-weight: 900;
            z-index: 1;
            opacity: 1;
            transition: opacity 0.3s var(--bezier);
        }

        .avatar-box { width: 48px; height: 48px; border-radius: 16px; background: var(--surface); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 500; position: relative; }
        .unread-dot {
            position: absolute;
            top: -2px; right: -2px;
            width: 12px; height: 12px;
            background: var(--badge-bg);
            border: 2px solid var(--bg);
            border-radius: 50%;
            display: none;
        }
        .has-unread .unread-dot { display: block; }
        
        .chat-unread-count {
            background: var(--badge-bg);
            color: var(--badge-text);
            font-size: 10px;
            font-weight: 900;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
        }

        .dock-container {
            position: fixed;
            bottom: 20px; left: 50%;
            transform: translateX(-50%);
            width: fit-content;
            z-index: 90;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.4s var(--bezier);
        }
        .dock-container.hidden {
            transform: translate(-50%, 120px);
            opacity: 0;
            pointer-events: none;
        }
        .dock-bar {
            background: var(--dock-bg);
            border: 1px solid var(--border);
            border-radius: 24px;
            padding: 4px 10px;
            display: flex;
            gap: 8px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
            touch-action: none;
        }
        .dock-tab {
            padding: 10px;
            color: var(--text-dim);
            transition: 0.3s var(--bezier);
            display: flex;
            align-items: center;
            position: relative;
        }
        .dock-tab.active { color: var(--text-main); transform: scale(1.1); }
        .dock-tab svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
        
        .dock-badge {
            position: absolute;
            top: 2px; right: 2px;
            background: var(--badge-bg);
            color: var(--badge-text);
            font-size: 9px;
            font-weight: 900;
            padding: 1px 4px;
            border-radius: 6px;
            min-width: 14px;
            text-align: center;
            display: none;
            border: 1px solid var(--bg);
        }

        .folder-pop {
            position: absolute;
            bottom: 70px; left: 50%; transform: translateX(-50%);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 18px;
            padding: 6px;
            display: none;
            width: 160px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }
        .folder-pop.active { display: block; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .folder-btn { padding: 10px; font-size: 13px; display: flex; align-items: center; gap: 8px; cursor: pointer; border-radius: 12px; transition: 0.2s; }
        .folder-btn:active { background: var(--border); transform: scale(0.96); }

        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; color: var(--text-dim); font-size: 12px; margin-bottom: 6px; text-transform: uppercase; letter-spacing: 1px; }
        .input-group input, .input-group textarea, .input-group select {
            width: 100%; background: var(--surface); border: 1px solid var(--border);
            padding: 12px; color: var(--text-main); border-radius: 10px; font-family: inherit; transition: border-color 0.3s;
        }
        .input-group input:focus { border-color: var(--text-dim); }
        .input-group textarea { resize: none; overflow: hidden; }

        .back-btn { padding: 10px 0; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: 600; transition: opacity 0.2s; }
        .back-btn:active { opacity: 0.6; }
        .back-btn svg { stroke: currentColor; fill: none; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; scroll-behavior: smooth; }
        .msg { max-width: 80%; padding: 12px 16px; border-radius: 18px; font-size: 14px; line-height: 1.4; position: relative; animation: msgIn 0.4s var(--bezier); }
        @keyframes msgIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .msg.in { background: var(--surface); align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid var(--border); }
        .msg.out { background: var(--accent); color: var(--bg); align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 500; }
        .msg-time { font-size: 10px; opacity: 0.6; margin-top: 4px; display: block; text-align: right; }

        .chat-input-area {
            padding: 16px;
            background: var(--bg);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .chat-input-wrapper {
            flex: 1;
            background: var(--surface);
            border-radius: 20px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            border: 1px solid var(--border);
        }
        .chat-input-wrapper input {
            flex: 1; background: none; border: none; color: var(--text-main); padding: 4px 0; font-family: inherit;
        }
        .icon-btn { color: var(--text-dim); cursor: pointer; display: flex; align-items: center; transition: 0.2s var(--bezier); }
        .icon-btn:active { transform: scale(0.85); color: var(--text-main); }
        .icon-btn.send { color: var(--text-main); }

        .folder-list-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            animation: fadeIn 0.4s var(--bezier);
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .folder-row { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .folder-actions { display: flex; gap: 12px; }
        .action-btn { font-size: 12px; font-weight: 600; cursor: pointer; opacity: 0.7; transition: 0.2s; }
        .action-btn:active { opacity: 1; transform: scale(0.9); }
        .delete-btn { color: #ff4444; }

        .toast-container {
            position: fixed;
            top: 20px;
            left: 0;
            right: 0;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            pointer-events: none;
        }
        .toast {
            background: var(--toast-bg);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 14px 24px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 12px;
            pointer-events: auto;
            touch-action: pan-x;
            transition: transform 0.4s var(--bezier), opacity 0.4s var(--bezier);
            user-select: none;
            width: fit-content;
            max-width: 90vw;
        }
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--error); }
        
        .toast-enter { animation: toastIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        .toast-exit { animation: toastOut 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards; }

        @keyframes toastIn {
            from { opacity: 0; transform: translateY(-30px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        @keyframes toastOut {
            to { opacity: 0; transform: translateY(-15px) scale(0.95); }
        }

        .channel-post {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 16px;
            overflow: hidden;
            animation: postIn 0.6s var(--bezier);
        }
        @keyframes postIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .channel-post-img { width: 100%; height: 180px; background: #1a1a1a; object-fit: cover; }
        .channel-post-content { padding: 14px; font-size: 14px; line-height: 1.5; }
        .channel-footer { padding: 8px 14px; display: flex; justify-content: space-between; color: var(--text-dim); font-size: 12px; border-top: 1px solid var(--border); }

        .chat-selector { margin-top: 8px; border-top: 1px solid var(--border); padding-top: 8px; }
        .select-item { display: flex; align-items: center; gap: 8px; font-size: 13px; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .select-item input { width: 18px; height: 18px; accent-color: var(--accent); }
        .folder-badge-list { display: flex; flex-wrap: wrap; gap: 4px; margin-top: 4px; }
        .chat-badge { font-size: 10px; background: var(--border); padding: 2px 6px; border-radius: 4px; color: var(--text-dim); }

        @keyframes popIn { from { opacity: 0; transform: translate(-50%, 20px) scale(0.8); } to { opacity: 1; transform: translate(-50%, 0) scale(1); } }
    </style>
</head>
<body>

    <div id="toastContainer" class="toast-container"></div>

    <div class="drawer-overlay" id="overlay" onclick="toggleDrawer(false)"></div>
    <div class="drawer" id="drawer">
        <div class="drawer-header">
            <div class="profile-pic-container">
                <img id="sideAvatar" src="https://i.pinimg.com/originals/a9/d0/03/a9d0033c46d302d9196b0253456c68a4.jpg">
            </div>
            <div id="sideName" style="font-weight:600">dmiTry</div>
            <div id="sideTag" style="color:var(--text-dim); font-size:12px">@shoker0215</div>
        </div>
        <div class="drawer-content">
            <div class="menu-item" onclick="openScreen('profileScreen')">
                <svg viewBox="0 0 24 24"><path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"/><circle cx="12" cy="7" r="4"/></svg>
                Мой профиль
            </div>
            <div class="divider"></div>
            <div class="menu-item">
                <svg viewBox="0 0 24 24"><path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21"/><circle cx="9" cy="7" r="4"/><path d="M23 21V19C22.9993 18.1137 22.7044 17.2524 22.1614 16.5523C21.6184 15.8522 20.8581 15.3516 20 15.13"/><path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88"/></svg>
                Создать группу
            </div>
            <div class="menu-item">
                <svg viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>
                Создать канал
            </div>
            <div class="menu-item">
                <svg viewBox="0 0 24 24"><path d="M19 21L12 16L5 21V5C5 4.46957 5.21071 3.96086 5.58579 3.58579C5.96086 3.21071 6.46957 3 7 3H17C17.5304 3 18.0391 3.21071 18.4142 3.58579C18.7893 3.96086 19 4.46957 19 5V21Z"/></svg>
                Избранное
            </div>
            <div class="menu-item" onclick="openScreen('settingsScreen')">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1-2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                Настройки
            </div>
        </div>
    </div>

    <div id="profileScreen" class="screen">
        <div style="padding: 20px;">
            <div class="back-btn" onclick="exitProfile()"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M19 12H5M12 19L5 12L12 5"/></svg> Назад</div>
            <div style="text-align:center; margin: 20px 0;">
                <div style="position:relative; width:100px; height:100px; margin:0 auto;">
                    <img id="mainAvatar" src="https://i.pinimg.com/originals/a9/d0/03/a9d0033c46d302d9196b0253456c68a4.jpg" style="width:100%; height:100%; border-radius:30px; object-fit:cover; border:1px solid var(--border);">
                    <label for="avatarInput" style="position:absolute; bottom:-5px; right:-5px; background:var(--accent); padding:8px; border-radius:50%; cursor:pointer; border: 1px solid var(--border)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="3"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                    </label>
                    <input type="file" id="avatarInput" hidden accept="image/*" onchange="updateAvatar(this)">
                </div>
            </div>
            <div class="input-group"><label>Имя</label><input type="text" id="editName" value="dmiTry"></div>
            <div class="input-group"><label>О себе</label><textarea id="aboutInput" rows="1" maxlength="250" oninput="autoHeight(this)">UI/UX Designer | Slant Core Developer</textarea></div>
            <div class="input-group"><label>Username</label><input type="text" id="usernameInput" value="@shoker0215" oninput="handleUsername(this)"></div>
        </div>
    </div>

    <div id="channelView" class="screen">
        <header style="border-bottom: 1px solid var(--border)">
            <div class="back-btn" onclick="closeScreen('channelView')"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M19 12H5M12 19L5 12L12 5"/></svg></div>
            <div style="flex: 1; margin-left: 15px;">
                <div style="font-weight: 600;">Slant News</div>
                <div style="color: var(--text-dim); font-size: 11px;">1.2k подписчиков</div>
            </div>
            <div class="icon-btn"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg></div>
        </header>
        <div class="chat-messages" id="channelMessages" style="background: var(--surface)">
            </div>
        <div class="chat-input-area" style="justify-content: center; background: var(--surface)">
            <div style="font-weight: 500; color: var(--text-dim); letter-spacing: 1px; font-size: 13px;">КАНАЛ В РЕЖИМЕ ЧТЕНИЯ</div>
        </div>
    </div>

    <div id="settingsScreen" class="screen">
        <div style="padding: 20px;">
            <div class="back-btn" onclick="closeScreen('settingsScreen')"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M19 12H5M12 19L5 12L12 5"/></svg> Назад</div>
            <h2 style="margin: 20px 0;">Настройки</h2>
            <div class="menu-item" onclick="toggleTheme()">
                <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                Сменить тему
            </div>
            <div class="menu-item" onclick="openScreen('folderManagerScreen')">
                <svg viewBox="0 0 24 24"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                Управление папками
            </div>
            <div class="menu-item"><svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg> Конфиденциальность</div>
            <div class="menu-item"><svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg> Звонки</div>
        </div>
    </div>

    <div id="folderManagerScreen" class="screen">
        <div style="padding: 20px; flex:1; overflow-y:auto;">
            <div class="back-btn" onclick="closeScreen('folderManagerScreen')"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M19 12H5M12 19L5 12L12 5"/></svg> Назад</div>
            <h2 style="margin: 20px 0;">Управление папками</h2>
            
            <div id="folderList"></div>

            <div class="input-group" style="margin-top:20px">
                <label>Новая папка</label>
                <div style="display:flex; flex-direction:column; gap:10px">
                    <input type="text" id="newFolderName" placeholder="Название папки">
                    <select id="newFolderCategory">
                        <option value="all">Общий список</option>
                        <option value="people">Личные (Чаты)</option>
                        <option value="channels">Каналы</option>
                        <option value="groups">Группы</option>
                        <option value="bots">Боты</option>
                    </select>
                    <button onclick="addNewFolder()" style="background:var(--accent); color:var(--bg); border:none; border-radius:10px; padding:12px; font-weight:bold; cursor:pointer">СОЗДАТЬ ПАПКУ</button>
                </div>
            </div>
        </div>
    </div>

    <div id="chatView" class="screen">
        <header style="border-bottom: 1px solid var(--border)">
            <div class="back-btn" onclick="closeScreen('chatView')"><svg width="24" height="24" viewBox="0 0 24 24"><path d="M19 12H5M12 19L5 12L12 5"/></svg></div>
            <div id="chatHeaderName" style="font-weight: 600; flex: 1; margin-left: 15px;">Name</div>
            <div class="icon-btn"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg></div>
        </header>
        <div class="chat-messages" id="messageList">
            <div class="msg in">Привет! Как продвигается проект? <span class="msg-time">14:02</span></div>
            <div class="msg out">Все отлично, интегрирую векторные иконки. <span class="msg-time">14:05</span></div>
        </div>
        <div class="chat-input-area">
            <div class="icon-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg></div>
            <div class="chat-input-wrapper">
                <input type="text" placeholder="Сообщение..." id="msgInput">
            </div>
            <div class="icon-btn send" onclick="sendMessage()"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polyline points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
        </div>
    </div>

    <header>
        <div class="user-trigger" onclick="toggleDrawer(true)">
            <img id="headAvatar" src="https://i.pinimg.com/originals/a9/d0/03/a9d0033c46d302d9196b0253456c68a4.jpg">
        </div>
        <div class="header-center" id="mainTitle">SLANT</div>
        <div style="width:40px; text-align:right">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        </div>
    </header>

    <div class="main-content" id="chatList"></div>

    <div class="dock-container" id="mainDock">
        <div class="folder-pop" id="folderPop">
            <div id="folderOptions"></div>
        </div>
        <div class="dock-bar" id="dockBar">
            <div class="dock-tab active" data-type="all" onclick="dockAction(this, 'all')">
                <div class="dock-badge" id="badge-all">0</div>
                <svg viewBox="0 0 24 24"><path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            </div>
            <div class="dock-tab" data-type="people" onclick="dockAction(this, 'people')">
                <div class="dock-badge" id="badge-people">0</div>
                <svg viewBox="0 0 24 24"><path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21"/><circle cx="12" cy="7" r="4"/></svg>
            </div>
            <div class="dock-tab" data-type="channels" onclick="dockAction(this, 'channels')">
                <div class="dock-badge" id="badge-channels">0</div>
                <svg viewBox="0 0 24 24"><path d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z"/></svg>
            </div>
            <div class="dock-tab" data-type="groups" onclick="dockAction(this, 'groups')">
                <div class="dock-badge" id="badge-groups">0</div>
                <svg viewBox="0 0 24 24"><path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21"/><circle cx="9" cy="7" r="4"/><path d="M23 21V19C22.9993 18.1137 22.7044 17.2524 22.1614 16.5523C21.6184 15.8522 20.8581 15.3516 20 15.13"/><path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88"/></svg>
            </div>
            <div class="dock-tab" data-type="bots" onclick="dockAction(this, 'bots')">
                <div class="dock-badge" id="badge-bots">0</div>
                <svg viewBox="0 0 24 24"><rect x="4" y="4" width="16" height="16" rx="2" ry="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="15" x2="23" y2="15"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="15" x2="4" y2="15"/></svg>
            </div>
        </div>
    </div>

    <script>
        const chatData = [
            { id: 1, name: "S.L.A.N.T. Core", msg: "Vector engine online", type: "bots", code: "SC", unread: 0 },
            { id: 2, name: "Виктор", msg: "Иконки из файла применил?", type: "people", code: "В", unread: 0 },
            { id: 3, name: "Design Community", msg: "Check out feather icons", type: "channels", code: "DC", unread: 0 },
            { id: 4, name: "Dev Team", msg: "SVG assets integrated", type: "groups", code: "DT", unread: 0 },
            { id: 5, name: "Slant News", msg: "Обновление системы", type: "channels", code: "SN", unread: 0 }
        ];

        let folders = [
            { name: "Все", chats: [1,2,3,4,5], category: "all" },
            { name: "Работа", chats: [1,3,4], category: "all" },
            { name: "Личное", chats: [2], category: "people" }
        ];

        let currentSection = 'all';
        let editingFolderIndex = null;
        let lastFilter = 'Все';
        let lastIsCategory = false;
        let lastToastMsg = "";
        let lastToastTime = 0;

        const randomMsgs = ["Новый патч готов!", "Проверь пулл-реквест.", "Как дела?", "SVG иконки загружены.", "Система стабильна.", "Завтра созвон в 10."];
        
        function startMockMessenger() {
            setInterval(() => {
                const target = chatData[Math.floor(Math.random() * chatData.length)];
                target.msg = randomMsgs[Math.floor(Math.random() * randomMsgs.length)];
                target.unread++;
                renderChats(lastFilter, lastIsCategory);
                updateDockBadges();
                showToast(`Новое сообщение от ${target.name}`);
            }, 30000);
        }

        let startX = 0;
        function initGestures() {
            const dock = document.getElementById('dockBar');
            dock.addEventListener('touchstart', e => startX = e.touches[0].clientX, {passive: true});
            dock.addEventListener('touchend', e => {
                const endX = e.changedTouches[0].clientX;
                const diff = startX - endX;
                const sections = ['all', 'people', 'channels', 'groups', 'bots'];
                let idx = sections.indexOf(currentSection);

                if (Math.abs(diff) > 50) {
                    if (diff > 0 && idx < sections.length - 1) idx++;
                    else if (diff < 0 && idx > 0) idx--;
                    
                    const nextTab = document.querySelector(`.dock-tab[data-type="${sections[idx]}"]`);
                    dockAction(nextTab, sections[idx]);
                }
            }, {passive: true});
        }

        function handleChatSwipe(el, chatId, wrapper) {
            let sX = 0;
            const actionEl = wrapper.querySelector('.chat-read-action');
            el.addEventListener('touchstart', e => sX = e.touches[0].clientX, {passive: true});
            el.addEventListener('touchend', e => {
                const eX = e.changedTouches[0].clientX;
                if (sX - eX > 70) {
                    el.classList.add('swiped');
                    setTimeout(() => {
                        const chat = chatData.find(c => c.id === chatId);
                        if (chat) chat.unread = 0;
                        actionEl.style.opacity = '0';
                        el.classList.remove('swiped');
                        
                        setTimeout(() => {
                            renderChats(lastFilter, lastIsCategory);
                            updateDockBadges();
                            showToast('Прочитано', 'success');
                        }, 300);
                    }, 400);
                }
            }, {passive: true});
        }

        function showToast(text, type = '') {
            const now = Date.now();
            if (text === lastToastMsg && now - lastToastTime < 3000) return;
            
            lastToastMsg = text;
            lastToastTime = now;

            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type} toast-enter`;
            toast.innerHTML = `<span>${text}</span>`;
            
            let tStartX = 0;
            let currentX = 0;
            let isSwiping = false;

            toast.addEventListener('touchstart', e => {
                tStartX = e.touches[0].clientX;
                toast.style.transition = 'none';
                isSwiping = true;
            }, {passive: true});

            toast.addEventListener('touchmove', e => {
                if(!isSwiping) return;
                currentX = e.touches[0].clientX - tStartX;
                if(currentX < 0) currentX = currentX / 4; 
                toast.style.transform = `translateX(${currentX}px)`;
                toast.style.opacity = Math.max(0, 1 - Math.abs(currentX) / 250);
            }, {passive: true});

            toast.addEventListener('touchend', () => {
                isSwiping = false;
                toast.style.transition = 'transform 0.4s var(--bezier), opacity 0.4s var(--bezier)';
                
                if (Math.abs(currentX) > 100) {
                    toast.style.transform = `translateX(${currentX > 0 ? window.innerWidth : -window.innerWidth}px)`;
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 400);
                } else {
                    toast.style.transform = 'translateX(0)';
                    toast.style.opacity = '1';
                }
                currentX = 0;
            });

            container.appendChild(toast);
            setTimeout(() => {
                if (toast.parentElement && !isSwiping) {
                    toast.classList.replace('toast-enter', 'toast-exit');
                    setTimeout(() => toast.remove(), 400);
                }
            }, 3500);
        }

        function syncProfile() {
            const newName = document.getElementById('editName').value;
            const newTag = document.getElementById('usernameInput').value;
            document.getElementById('sideName').innerText = newName;
            document.getElementById('sideTag').innerText = newTag;
        }

        function exitProfile() {
            syncProfile();
            closeScreen('profileScreen');
            showToast('Узел профиля обновлен', 'success');
        }

        function renderChats(filterName = 'Все', isCategory = false) {
            lastFilter = filterName;
            lastIsCategory = isCategory;
            const list = document.getElementById('chatList');
            const pop = document.getElementById('folderPop');
            pop.classList.remove('active');
            list.innerHTML = '';
            
            let filtered;
            if (isCategory) {
                filtered = chatData.filter(c => c.type === filterName);
            } else {
                const folder = folders.find(f => f.name === filterName);
                filtered = chatData.filter(c => folder.chats.includes(c.id));
            }

            filtered.forEach(chat => {
                const wrapper = document.createElement('div');
                wrapper.className = 'chat-item-wrapper';
                
                const item = document.createElement('div');
                item.className = `chat-item ${chat.unread > 0 ? 'has-unread' : ''}`;
                
                const action = document.createElement('div');
                action.className = 'chat-read-action';
                action.innerText = 'READ';
                wrapper.appendChild(action);

                handleChatSwipe(item, chat.id, wrapper);

                item.onclick = (e) => {
                    if (item.classList.contains('swiped')) return;
                    chat.unread = 0;
                    if (chat.name === "Slant News") openScreen('channelView');
                    else openChat(chat.name);
                    renderChats(lastFilter, lastIsCategory);
                    updateDockBadges();
                };

                const unreadBadge = chat.unread > 0 ? `<div class="chat-unread-count">${chat.unread}</div>` : '';

                item.innerHTML = `
                    <div class="avatar-box">${chat.code}<div class="unread-dot"></div></div>
                    <div style="flex:1">
                        <div style="display:flex; justify-content:space-between">
                            <span style="font-weight:600">${chat.name}</span>
                            <span style="color:var(--text-dim); font-size:11px">14:20</span>
                        </div>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-top:4px">
                            <div style="color:var(--text-dim); font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:70vw">${chat.msg}</div>
                            ${unreadBadge}
                        </div>
                    </div>
                `;

                wrapper.appendChild(item);
                list.appendChild(wrapper);
            });
            updateFolderPop();
            updateHeaderTitle();
        }

        function updateDockBadges() {
            const sections = ['all', 'people', 'channels', 'groups', 'bots'];
            sections.forEach(sec => {
                const badge = document.getElementById(`badge-${sec}`);
                let count = 0;
                if (sec === 'all') {
                    count = chatData.filter(c => c.unread > 0).length;
                } else {
                    count = chatData.filter(c => c.type === sec && c.unread > 0).length;
                }
                
                if (count > 0) {
                    badge.innerText = count;
                    badge.style.display = 'block';
                } else {
                    badge.style.display = 'none';
                }
            });
        }

        function updateHeaderTitle() {
            const titles = {
                'all': 'SLANT',
                'people': 'ЧАТЫ',
                'channels': 'КАНАЛЫ',
                'groups': 'ГРУППЫ',
                'bots': 'БОТЫ'
            };
            document.getElementById('mainTitle').innerText = titles[currentSection] || 'SLANT';
        }

        function updateFolderPop() {
            const container = document.getElementById('folderOptions');
            container.innerHTML = '';
            
            const defaultDiv = document.createElement('div');
            defaultDiv.className = 'folder-btn';
            defaultDiv.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>Все`;
            defaultDiv.onclick = () => {
                if(currentSection === 'all') renderChats('Все');
                else renderChats(currentSection, true);
            };
            container.appendChild(defaultDiv);

            folders.filter(f => f.category === currentSection && f.name !== "Все").forEach(f => {
                const div = document.createElement('div');
                div.className = 'folder-btn';
                div.innerHTML = `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>${f.name}`;
                div.onclick = () => renderChats(f.name);
                container.appendChild(div);
            });
        }

        function dockAction(el, filter) {
            if(!el) return;
            const isSelected = el.classList.contains('active');
            const pop = document.getElementById('folderPop');
            document.querySelectorAll('.dock-tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
            
            currentSection = filter;
            
            if (isSelected) { 
                pop.classList.toggle('active'); 
            } else { 
                pop.classList.remove('active'); 
                if (filter === 'all') renderChats('Все');
                else renderChats(filter, true); 
            }
            updateFolderPop();
        }

        function openChat(name) {
            document.getElementById('chatHeaderName').innerText = name;
            openScreen('chatView');
        }

        function sendMessage() {
            const input = document.getElementById('msgInput');
            const list = document.getElementById('messageList');
            if (input.value.trim() !== "") {
                const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const msg = document.createElement('div');
                msg.className = 'msg out';
                msg.innerHTML = `${input.value} <span class="msg-time">${time}</span>`;
                list.appendChild(msg);
                input.value = "";
                list.scrollTop = list.scrollHeight;
            }
        }

        function toggleDrawer(show) {
            document.getElementById('drawer').classList.toggle('active', show);
            document.getElementById('overlay').classList.toggle('active', show);
        }

        function openScreen(id) { 
            toggleDrawer(false); 
            document.getElementById(id).classList.add('active'); 
            document.getElementById('mainDock').classList.add('hidden');
            if(id === 'folderManagerScreen') renderFolderManager();
            if(id === 'channelView') renderChannelContent();
        }

        function closeScreen(id) { 
            document.getElementById(id).classList.remove('active'); 
            const activeScreens = document.querySelectorAll('.screen.active').length;
            if (activeScreens === 0) {
                document.getElementById('mainDock').classList.remove('hidden');
            }
        }

        function updateAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('mainAvatar').src = e.target.result;
                    document.getElementById('headAvatar').src = e.target.result;
                    document.getElementById('sideAvatar').src = e.target.result;
                    showToast('Аватар обновлен', 'success');
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function autoHeight(el) {
            el.style.height = 'auto';
            el.style.height = el.scrollHeight + 'px';
        }

        function handleUsername(el) {
            if (!el.value.startsWith('@')) {
                el.value = '@' + el.value.replace(/@/g, '');
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('light-theme');
            showToast('Цветовая схема изменена');
        }

        function renderFolderManager() {
            const list = document.getElementById('folderList');
            list.innerHTML = '';
            folders.forEach((f, index) => {
                if (f.name === "Все") return;
                const item = document.createElement('div');
                item.className = 'folder-list-item';
                
                const badges = f.chats.map(id => {
                    const chat = chatData.find(c => c.id === id);
                    return `<span class="chat-badge">${chat ? chat.name : id}</span>`;
                }).join('');

                let chatsHTML = '';
                if (editingFolderIndex === index) {
                    chatsHTML = `<div class="chat-selector">
                        <label>Название</label>
                        <input type="text" id="rename-${index}" value="${f.name}" style="background:var(--bg); border:1px solid var(--border); color:var(--text-main); margin-bottom:10px; padding:8px; border-radius:8px; width:100%">
                        <label>Раздел отображения</label>
                        <select id="recat-${index}" style="background:var(--bg); border:1px solid var(--border); color:var(--text-main); margin-bottom:10px; padding:8px; border-radius:8px; width:100%">
                            <option value="all" ${f.category === 'all' ? 'selected' : ''}>Общий список</option>
                            <option value="people" ${f.category === 'people' ? 'selected' : ''}>Чаты</option>
                            <option value="channels" ${f.category === 'channels' ? 'selected' : ''}>Каналы</option>
                            <option value="groups" ${f.category === 'groups' ? 'selected' : ''}>Группы</option>
                            <option value="bots" ${f.category === 'bots' ? 'selected' : ''}>Боты</option>
                        </select>
                        <label>Управление чатами</label>
                        ${chatData.map(c => `
                            <label class="select-item">
                                <input type="checkbox" ${f.chats.includes(c.id) ? 'checked' : ''} onchange="toggleChatInFolder(${index}, ${c.id})">
                                ${c.name}
                            </label>
                        `).join('')}
                    </div>`;
                }

                item.innerHTML = `
                    <div class="folder-row">
                        <div>
                            <div style="font-weight:bold">${f.name}</div>
                            <div style="font-size:10px; color:var(--text-dim)">Категория: ${f.category}</div>
                            <div class="folder-badge-list">${badges}</div>
                        </div>
                        <div class="folder-actions">
                            <span class="action-btn" onclick="toggleEditFolder(${index})">${editingFolderIndex === index ? 'СОХРАНИТЬ' : 'ПРАВКА'}</span>
                            <span class="action-btn delete-btn" onclick="deleteFolder(${index})">УДАЛИТЬ</span>
                        </div>
                    </div>
                    ${chatsHTML}
                `;
                list.appendChild(item);
            });
        }

        function toggleEditFolder(index) {
            if (editingFolderIndex === index) {
                const newName = document.getElementById(`rename-${index}`).value;
                const newCat = document.getElementById(`recat-${index}`).value;
                if(newName) folders[index].name = newName;
                folders[index].category = newCat;
                editingFolderIndex = null;
                showToast('Папка сохранена', 'success');
            } else {
                editingFolderIndex = index;
            }
            renderFolderManager();
            updateFolderPop();
        }

        function toggleChatInFolder(folderIdx, chatId) {
            const chatIdx = folders[folderIdx].chats.indexOf(chatId);
            if (chatIdx > -1) folders[folderIdx].chats.splice(chatIdx, 1);
            else folders[folderIdx].chats.push(chatId);
        }

        function addNewFolder() {
            const name = document.getElementById('newFolderName').value.trim();
            const category = document.getElementById('newFolderCategory').value;
            if (name && !folders.find(f => f.name === name)) {
                folders.push({ name: name, chats: [], category: category });
                document.getElementById('newFolderName').value = '';
                renderFolderManager();
                updateFolderPop();
                showToast('Папка создана', 'success');
            } else {
                showToast('Ошибка создания папки', 'error');
            }
        }

        function deleteFolder(index) {
            folders.splice(index, 1);
            renderFolderManager();
            updateFolderPop();
            showToast('Папка удалена');
        }

        function renderChannelContent() {
            const container = document.getElementById('channelMessages');
            container.innerHTML = `
                <div class="channel-post">
                    <img class="channel-post-img" src="https://images.unsplash.com/photo-1614850523296-d8c1af93d400?q=80&w=500&auto=format&fit=crop">
                    <div class="channel-post-content">
                        <b>UPDATE 2.2.0: SMOOTH CORE</b><br><br>
                        1. <b>Плавность:</b> Все анимации переведены на Cubic Bezier (0.4, 0, 0.2, 1) для ощущения отзывчивости.<br>
                        2. <b>Интерактивные тосты:</b> Теперь уведомления можно смахнуть вправо жестом.<br>
                        3. <b>Глубина:</b> Добавлены мягкие тени и размытие (blur) для элементов интерфейса.<br>
                        4. <b>Физика:</b> Экраны открываются с эффектом инерции.
                    </div>
                    <div class="channel-footer">
                        <span>Только что</span>
                        <span>👁 1.8k</span>
                    </div>
                </div>
            `;
        }

        window.onload = () => {
            renderChats('Все');
            updateDockBadges();
            autoHeight(document.getElementById('aboutInput'));
            initGestures();
            startMockMessenger();
        };
    </script>
</body>
</html>
